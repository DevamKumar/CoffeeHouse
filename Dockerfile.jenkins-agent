# âœ… Uses Gradle + Java 21, compatible with Spring Boot 3.5.3 and arm64 (M1/M2/M3)
FROM gradle:8.7.0-jdk21

USER root

# Install Docker CLI
RUN apt-get update && \
    apt-get install -y docker.io curl unzip && \
    apt-get clean

# Install kubectl for ARM64
RUN curl -LO "https://dl.k8s.io/release/$(curl -s https://dl.k8s.io/release/stable.txt)/bin/linux/arm64/kubectl" && \
    install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl && \
    rm kubectl

# Install ArgoCD CLI for ARM64
RUN curl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-arm64 && \
    chmod +x /usr/local/bin/argocd

VOLUME /var/run/docker.sock

USER gradle
